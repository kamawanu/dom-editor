#! /usr/bin/env python
# vi: set syntax=python : */

import findrox

no_gui_mode = 0

# Ugly hack to stop wierd chars appearing...
#import xml.dom.html
#xml.dom.html.HTML_CHARACTER_ENTITIES = {}

import sys
from os.path import dirname

app_dir = dirname(sys.argv[0])

import gtk
from Window import Window

tl_windows = 0

#import signal

#import debug
#signal.signal(signal.SIGINT, debug.debug_prompt)

sys.argv.append('--disable-crash-dialog')
import gnome.ui
sys.argv.pop()

def tl_ref(w = None):
	global tl_windows
	tl_windows = tl_windows + 1

def tl_unref(w = None):
	global tl_windows
	tl_windows = tl_windows - 1
	if tl_windows < 1:
		gtk.mainquit()

docs = []

if len(sys.argv) > 1:
	files = sys.argv[1:]
	del sys.argv[1:]		# GnomeCanvas can't cope with -
	win = apply(Window, files)
else:
	win = Window()

win.connect('destroy', tl_unref)
tl_ref()
win.show()

if tl_windows > 0:
	#import profile
	#profile.run('gtk.mainloop()')

	gtk.mainloop()
